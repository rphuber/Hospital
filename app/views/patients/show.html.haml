=title "#{@patient.first_name} #{@patient.last_name}'s Detail"
%article.type-system-rounded
  .patient-details-container
    %h1 
      Patient Record Detail
    %p.type= @patient.workflow_state
    .patient-details
      %p.date
        %strong Last Updated: 
        = Date.parse(@patient.updated_at.to_s).strftime("%m/%d/%Y")
      %hr/
      %p
        %strong Date of Birth:
        = Date.parse(@patient.dob.to_s).strftime("%m/%d/%Y") 
      %p
        %strong Gender:
        = @patient.gender

        %p
          %strong Symptoms:
          = @patient.symptoms

        %p
          %strong Blood Type:
          = @patient.blood_type
    .workflow-links
      - case @patient.workflow_state
        - when 'waiting_room'
          = link_to image_tag('icons/check-in.png'), check_in_patient_path(@patient), method: :patch
        - when 'checked_in'
          = link_to image_tag('icons/doctor.png'), see_doctor_patient_path(@patient), method: :patch
          = link_to image_tag('icons/xray.png'), get_xray_patient_path(@patient), method: :patch
          = link_to image_tag('icons/surgery.png'), enter_surgery_patient_path(@patient), method: :patch
        - when 'with_doctor'
          = link_to image_tag('icons/xray.png'), get_xray_patient_path(@patient), method: :patch
          = link_to image_tag('icons/surgery.png'), enter_surgery_patient_path(@patient), method: :patch
          = link_to image_tag('icons/check-out.png'), check_out_patient_path(@patient), method: :patch
        - when 'in_xray'
          = link_to image_tag('icons/doctor.png'), see_doctor_patient_path(@patient), method: :patch
          = link_to image_tag('icons/surgery.png'), enter_surgery_patient_path(@patient), method: :patch
          = link_to image_tag('icons/check-out.png'), check_out_patient_path(@patient), method: :patch
        - when 'in_surgery'
          = link_to image_tag('icons/xray.png'), get_xray_patient_path(@patient), method: :patch
          = link_to image_tag('icons/doctor.png'), see_doctor_patient_path(@patient), method: :patch
          = link_to image_tag('icons/check-out.png'), check_out_patient_path(@patient), method: :patch
        - else
          = link_to image_tag('icons/bill-pay.png'), pay_bill_patient_path(@patient), method: :patch
  %hr/

  %h4 
    Medications

    %table
      %thead
        %tr
          %th Name
          %th Dosage
          %th Frequency
      %tbody
        - @medications.each do |medication|
          %tr
            %td
              = medication.name
            %td
              = medication.dosage
            %td
              = medication.frequency
    %p
      %strong
        = succeed ':' do
          = "Doctor".pluralize(@patient.doctors.length)
      %br/
      - @patient.doctors.each do |doctor|
        = doctor.name
        %br/

      = form_for @doctor, url: create_doctor_patient_path(@patient) do |f|
        = f.label :name, "Add Doctor:"
        = f.text_field :name, {:placeholder => "Enter name"}
  
    = link_to "Back to Patient List", patients_path, class: "button"
    = link_to 'Edit Details', edit_patient_path(@patient), class: "button"
